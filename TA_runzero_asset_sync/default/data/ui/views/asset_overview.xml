<form theme="dark" version="1.1">
  <label>runZero Asset Overview</label>
  <fieldset submitButton="false">
    <input type="time" token="time_tok" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  
  <row>
    <panel>
      <title>Unique Asset Count</title>
      <single>
        <search>
          <query>search = `runzero-index` sourcetype=assets | dedup id | stats count AS total_assets</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["#008099","#008099"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Assets by Type</title>
      <chart>
        <search>
          <query>search = `runzero-index` sourcetype=assets type != "" | dedup id | stats count BY type | sort - count</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Asset OS Version Breakdown (Top 10)</title>
      <chart>
        <search>
          <query>search = `runzero-index` sourcetype=assets os_product != "" os_version != "" | dedup id | chart count over os_product by os_version | sort - Count | head 10</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>New Assets (Last 24 Hours)</title>
      <table>
        <search>
          <query>search = `runzero-index` sourcetype=assets earliest=-1d | dedup id | sort 0 - updated_at | table host, dvc_ip, os_product, asset_updated | rename host as "Asset Name", dvc_ip as "Primary IP", os_product as "OS", asset_updated as "Last Sync"</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Top Service Products</title>
      <chart>
        <search>
          <query>search = `runzero-index` sourcetype=assets | rename "service_products{}" AS service_products | eval service_products = split(mvjoin(service_products, " "), " ") | mvexpand service_products | where service_products != "" | top limit=20 service_products</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.seriesColors">{"count":0x008099}</option>
      </chart>
    </panel>
    <panel>
      <title>Asset Hardware Vendors</title>
      <chart>
        <search>
          <query>search = `runzero-index` sourcetype=assets hw_vendor != "" | dedup id | stats count by hw_vendor | sort - count | head 15</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.seriesColors">{"count":0x02B699}</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Environment Averages</title>
      <single>
        <search>
          <query>search = `runzero-index` sourcetype=assets | stats avg(service_count) as avg_services</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="underLabel">Avg Services</option>
        <option name="rangeColors">["#008099","#008099"]</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0.0</option>
      </single>
      <single>
        <search>
          <query>search = `runzero-index` sourcetype=assets | stats avg(software_count) as avg_software</query>
          <earliest>$time_tok.earliest$</earliest>
          <latest>$time_tok.latest$</latest>
        </search>
        <option name="underLabel">Avg Software</option>
        <option name="rangeColors">["#02B699","#02B699"]</option>
        <option name="useColors">1</option>
        <option name="numberPrecision">0.0</option>
      </single>
    </panel>
  </row>
</form>