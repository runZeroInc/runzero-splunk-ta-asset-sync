[source::...TA_runzero_asset_sync*.log*]
sourcetype = tarunzeroassetsync:log

[assets]
KV_MODE = json
SHOULD_LINEMERGE = false
TIMESTAMP_FIELDS = _splunk_event_ts
TRUNCATE = 5000000
TZ = UTC
category = runZero Inventory

## --- Naming & IP Logic ---
# Filter bracketed names list and pick the first valid entry
EVAL-host = coalesce(mvindex(mvfilter('names{}' != "" AND isnotnull('names{}')), 0), id)

# Filter bracketed addresses for RFC1918 Private IPs, fallback to first available address, then ID
EVAL-dvc_ip = coalesce(mvindex(mvfilter(match('addresses{}', "(^127\.0\.0\.1)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)|(^192\.168\.)")), 0), mvindex('addresses{}', 0), id)

## --- CIM Mappings (Inventory & Network Models) ---
EVAL-dest_ip  = dvc_ip
EVAL-dest_mac = mvindex('macs{}', 0)
EVAL-dest     = host

# Risk & Severity
EVAL-severity      = risk
EVAL-dest_priority = risk_rank

# Vendor & Product Details
EVAL-vendor_product = "runZero Asset Inventory"
EVAL-vendor         = "runZero"
EVAL-os             = coalesce(os_product, os_vendor, os_version, os)
EVAL-version        = os_version
EVAL-dns            = mvindex('domains{}', 0)
EVAL-description    = if(isnotnull(comments), comments, "")
EVAL-hw             = coalesce(hw_vendor + " " + hw_product, hw)

# Extra JSON Mappings
FIELDALIAS-runzero_owner = "ownership{}.name" AS owner

## --- Time Normalization ---
EVAL-asset_created    = if(isnum(created_at), strftime(created_at, "%Y-%m-%dT%H:%M:%SZ"), created_at)
EVAL-asset_first_seen = if(isnum(first_seen), strftime(first_seen, "%Y-%m-%dT%H:%M:%SZ"), first_seen)
EVAL-asset_last_seen  = if(isnum(last_seen), strftime(last_seen, "%Y-%m-%dT%H:%M:%SZ"), last_seen)
EVAL-asset_updated    = if(isnum(updated_at), strftime(updated_at, "%Y-%m-%dT%H:%M:%SZ"), updated_at)